<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hi, I'm RiseForever.</title>
    <style>
        html, body, * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        img {
            -webkit-user-drag: none;
            user-drag: none;
        }
        body {
            margin: 0;
            font-family: "Lora", serif;
            display: flex;
            flex-direction: column;
            justify-content: center; /* å±…ä¸­æ˜¾ç¤º */
            align-items: center;
            height: 100vh;
            background: linear-gradient(to bottom, #a8d8ea, #39c5bb, #f7f9fb);
            color: #333;
            transition: background 0.5s ease, color 0.5s ease;
            padding: 0 20px;
            overflow: hidden; /* ç¦æ­¢é¡µé¢ä¸Šä¸‹æ»‘åŠ¨ */
        }

        .content-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 1200px;
        }

        .left-content {
            flex: 2;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .header {
            font-size: 40px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .subtext {
            font-size: 20px;
            margin-top: 0;
        }

        .photo {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 30px;
        }

        .photo img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .toggle-mode {
            position: fixed;
            top: 20px;
            right: 20px;
            cursor: pointer;
            font-size: 24px;
            padding: 10px;
            border: none;
            background: none;
            z-index: 30;
        }

        .dark-mode {
            background: linear-gradient(to bottom, #274046, #4b6b8b, #1b2735);
            color: #ddd;
        }

        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            font-size: 12px;
            color: #666;
            padding: 10px 0;
            text-align: center;
            background-color: transparent;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* å°å±å¹•æ—¶éšè— emoji */
        @media (max-width: 768px) {
            .emoji {
                display: none;
            }

            .header::after {
                content: ".";
            }
        }

        /* é¦–é¡µé¢å·¦å³ç•™ç™½ï¼Œé¿å…è¢«æ¢é¡µæŒ‰é’®è¦†ç›– */
        #page-home .content-wrapper { padding: 0 56px; box-sizing: border-box; }
        @media (max-width: 768px) { #page-home .content-wrapper { padding: 0 48px; } }
        /* ç¬¬äºŒé¡µæ•´ä½“å·¦å³ç•™ç™½ï¼ˆç»™â€œçª—å£â€æœ¬èº«åŠ è¾¹è·ï¼‰ï¼Œé¿å…è¢«æ¢é¡µæŒ‰é’®è¦†ç›– */
        #page-status .panel { width: calc(100% - 112px); margin: 0 56px; }
        @media (max-width: 768px) { #page-status .panel { width: calc(100% - 96px); margin: 0 48px; } }

        /* åˆ†é¡µå®¹å™¨ï¼ˆä¸¤é¡µå·¦å³åˆ‡æ¢ï¼‰ */
        .pages {
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        .slides {
            position: absolute;
            left: 0;
            top: 0;
            display: flex;
            width: 200vw;
            height: 100%;
            transition: transform .35s ease;
        }
        .page {
            width: 100vw;
            height: 100%;
            flex: 0 0 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            box-sizing: border-box;
        }
        .nav-btn {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            padding: 10px 12px;
            border-radius: 10px;
            background: rgba(255,255,255,0.7);
            border: 1px solid rgba(0,0,0,0.15);
            cursor: pointer;
            font-size: 14px;
            z-index: 10;
        }
        .nav-left { left: 12px; }
        .nav-right { right: 12px; }
        .dark-mode .nav-btn { background: rgba(39,57,77,0.85); color: #ddd; border-color: rgba(255,255,255,0.22); }
        .panel {
            background: rgba(255,255,255,0.92);
            color: #333;
            border-radius: 12px;
            width: 100%;
            max-width: 880px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 6px 18px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .panel.dark {
            background: rgba(27,39,53,0.95);
            color: #ddd;
        }
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            font-weight: bold;
            font-size: 18px;
            border-bottom: 1px solid rgba(0,0,0,0.08);
        }
        .panel.dark .panel-header { border-bottom-color: rgba(255,255,255,0.12); }
        .panel-body {
            padding: 12px 18px;
            overflow: auto;
        }
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        .list {
            margin: 0;
            padding: 0;
            list-style: none;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.08);
        }
        .panel.dark .list { border-color: rgba(255,255,255,0.12); }
        .item {
            display: grid;
            grid-template-columns: 140px 120px 1fr;
            gap: 12px;
            padding: 10px 12px;
            background: rgba(255,255,255,0.65);
            border-bottom: 1px solid rgba(0,0,0,0.06);
        }
        .panel.dark .item { background: rgba(39,57,77,0.65); border-bottom-color: rgba(255,255,255,0.08); }
        .item:last-child { border-bottom: none; }
        .type-pill {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(0,0,0,0.06);
        }
        .panel.dark .type-pill { background: rgba(255,255,255,0.12); }
        .muted { color: #666; font-size: 12px; }
        .panel.dark .muted { color: #bbb; }
        .nowrap { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .title-link { cursor: pointer; text-decoration: underline dotted; }
        .panel.dark .title-link { color: #ddd; }
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        .pager {
            display: flex;
            gap: 8px;
        }
        .btn {
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.15);
            background: rgba(255,255,255,0.75);
            cursor: pointer;
        }
        .btn:disabled { opacity: .5; cursor: not-allowed; }
        .panel.dark .btn { border-color: rgba(255,255,255,0.22); background: rgba(39,57,77,0.85); color: #ddd; }
        
        /* è‡ªå®šä¹‰å¼¹çª—ï¼šä¸ç¬¬äºŒé¡µçª—å£é£æ ¼ç±»ä¼¼ */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.35); display: none; align-items: center; justify-content: center; padding: 20px; z-index: 50; }
        .modal-overlay.active { display: flex; }
        .modal-panel { background: rgba(255,255,255,0.95); color: #333; border-radius: 12px; width: min(90vw, 720px); max-height: 70vh; box-shadow: 0 6px 18px rgba(0,0,0,0.2); display: flex; flex-direction: column; overflow: hidden; }
        .dark-mode .modal-panel { background: rgba(27,39,53,0.95); color: #ddd; }
        .modal-header { display:flex; align-items:center; justify-content: space-between; padding: 12px 16px; font-weight: bold; border-bottom: 1px solid rgba(0,0,0,0.08); }
        .dark-mode .modal-header { border-bottom-color: rgba(255,255,255,0.12); }
        .modal-body { padding: 16px; overflow: auto; word-break: break-all; }
        .modal-actions { display:flex; justify-content:flex-end; padding: 10px 16px; gap: 8px; border-top: 1px solid rgba(0,0,0,0.06); }
        .dark-mode .modal-actions { border-top-color: rgba(255,255,255,0.12); }
        .icon-btn { width: 32px; height: 32px; border: none; background: transparent; cursor: pointer; font-size: 20px; line-height: 32px; color: inherit; border-radius: 6px; }
        .icon-btn:hover { background: rgba(0,0,0,0.06); }
        .dark-mode .icon-btn:hover { background: rgba(255,255,255,0.12); }
        /* æ·±è‰²æ¨¡å¼ä¸‹å¼¹çª—æŒ‰é’®å¤–è§‚ä¸ç¬¬äºŒé¡µæŒ‰é’®ä¸€è‡´ */
        .dark-mode .modal-panel .btn { border-color: rgba(255,255,255,0.22); background: rgba(39,57,77,0.85); color: #ddd; }
    </style>
    <link id="font-link" rel="stylesheet">
    <link id="cdn-link" rel="stylesheet">
</head>
<body>
    <button class="toggle-mode" onclick="toggleMode()">
        <i id="mode-icon" class="fas fa-sun"></i>
    </button>

    <!-- åˆ†é¡µå®¹å™¨ -->
    <div class="pages" id="pages">
        <div class="slides" id="slides">
            <!-- ç¬¬1é¡µï¼šåŸä¸ªäººä¸»é¡µ -->
            <section class="page" id="page-home">
                <div class="content-wrapper">
                    <div class="left-content">
                        <div id="third-line" class="subtext">Hi,there. Welcome!</div>
                        <div class="header">I'm RiseForever<span class="emoji">ğŸ¯</span></div>
                        <div class="subtext">Chinese Â· Student Â· Developer<br>
                            <a href="https://luming.cool">Blog </a> | <a href="https://github.com/virelyx258"> Github</a> | <a href="mailto:hi@riseforever.cn"> Email</a>
                        </div>
                    </div>
                    <div class="photo">
                        <img src="https://cn.cravatar.com/avatar/302380667bdaf4e1390800e62494d4af?s=500&r=X" alt="Sample Photo">
                    </div>
                </div>
            </section>

            <!-- ç¬¬2é¡µï¼šè®¾å¤‡çŠ¶æ€è§†å¥¸é¡µ -->
            <section class="page" id="page-status">
                <div class="panel" id="panel">
                    <div class="panel-header">
                        <span>ğŸ‘è§†å¥¸æˆ‘ğŸ‘</span>
                        <div class="muted">æ•°æ®æ¥è‡ª<a href="https://status.riseforever.cn" target="_blank">status.riseforever.cn</a></div>
                    </div>
                    <div class="panel-body">
                        <div class="status-bar">
                            <div>æ€»ä½“çŠ¶æ€ï¼š<span id="overall">-</span></div>
                            <div class="muted" id="uptime">æ›´æ–°æ—¶é—´ï¼š-</div>
                        </div>
                        <ul class="list" id="deviceList"></ul>
                        <div class="controls">
                            <div class="muted">å…± <span id="totalCount">0</span> å°è®¾å¤‡ï¼Œé¡µç  <span id="pageInfo">1/1</span></div>
                            <div class="pager">
                                <button class="btn" id="prevBtn" onclick="gotoPrev()">ä¸Šä¸€é¡µ</button>
                                <button class="btn" id="nextBtn" onclick="gotoNext()">ä¸‹ä¸€é¡µ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <button class="nav-btn nav-left" onclick="goLeft()">â†</button>
        <button class="nav-btn nav-right" onclick="goRight()">â†’</button>
    </div>
    <div class="footer" style="z-index:20;">&copy; 2025 RiseForever. Based on <a href="https://github.com/ScDuckXu/SntroPage" target="_blank">SntroPage</a>.</div>
    <!-- æ ‡é¢˜å¼¹çª— -->
    <div class="modal-overlay" id="titleModal">
        <div class="modal-panel">
            <div class="modal-header">
                <span id="titleModalHeaderText"></span>
                <button class="icon-btn" onclick="closeTitleModal()" aria-label="å…³é—­">&times;</button>
            </div>
            <div class="modal-body" id="titleModalBody"></div>
            <div class="modal-actions">
                <button class="btn" onclick="closeTitleModal()">å·²é˜…</button>
            </div>
        </div>
    </div>
    <script>
        function fetchUserLocation() {
            fetch('https://ipinfo.io/json')
                .then(response => response.json())
                .then(data => {
                    const country = data.country;
                    const ip = data.ip;
                    const location = `${data.city}, ${data.region}`;
                    document.getElementById('third-line').innerHTML = `Hi, there. ${ip} From ${location} - Welcome!`;

                    // åŠ¨æ€åˆ‡æ¢CDN
                    const fontLink = document.getElementById("font-link");
                    const cdnLink = document.getElementById("cdn-link");

                    if (country === "CN") {
                        fontLink.href = "https://fonts.font.im/css2?family=Lora:wght@400;700&display=swap";
                        cdnLink.href = "https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css";
                    } else {
                        fontLink.href = "https://fonts.googleapis.com/css2?family=Lora:wght@400;700&display=swap";
                        cdnLink.href = "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css";
                    }
                })
                .catch(error => console.error('Error fetching location data:', error));
        }

        function detectColorScheme() {
            const prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');

            if (prefersDarkMode.matches) {
                document.body.classList.add('dark-mode');
                document.getElementById('mode-icon').classList.replace('fa-sun', 'fa-moon');
            }
        }

        function setupColorSchemeListener() {
            const colorSchemeQuery = window.matchMedia('(prefers-color-scheme: dark)');
            
            colorSchemeQuery.addEventListener('change', (e) => {
                if (e.matches) {
                    document.body.classList.add('dark-mode');
                    document.getElementById('mode-icon').classList.replace('fa-sun', 'fa-moon');
                } else {
                    document.body.classList.remove('dark-mode');
                    document.getElementById('mode-icon').classList.replace('fa-moon', 'fa-sun');
                }
            });
        }

        function toggleMode() {
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('mode-icon');
            icon.classList.toggle('fa-sun');
            icon.classList.toggle('fa-moon');
            // ä¿éšœé¢æ¿æ ·å¼åŒæ­¥ï¼ˆå³ä¾¿ MutationObserver å› æµè§ˆå™¨å·®å¼‚æœªè§¦å‘ï¼‰
            syncPanelTheme();
        }

        window.onload = function() {
            fetchUserLocation();
            detectColorScheme();
            setupColorSchemeListener();
            initStatusView();
            initPaging();
            // å¯åŠ¨å…¨å±€å®šæ—¶åˆ·æ–°ï¼ˆä»…åœ¨çŠ¶æ€é¡µæ—¶æ‰§è¡Œåˆ·æ–°ï¼‰
            if (refreshTimer) clearInterval(refreshTimer);
            refreshTimer = setInterval(() => { if (currentSlide === 1) refreshStatus(); }, 3000);
            // ç¦æ­¢å›¾ç‰‡æ‹–åŠ¨
            document.querySelectorAll('img').forEach(img => img.setAttribute('draggable', 'false'));
            document.addEventListener('dragstart', (e) => { if (e.target && e.target.tagName === 'IMG') e.preventDefault(); });
        };

        // ===== è®¾å¤‡çŠ¶æ€è§†å›¾ä¸åˆ†é¡µ =====
        const API_STATUS = 'https://status.riseforever.cn/api/status';
        const PAGE_SIZE = 8;
        let allDevices = [];
        let currentPage = 1;
        let refreshTimer = null;

        function initStatusView() {
            // æ·±è‰²æ¨¡å¼è”åŠ¨é¢æ¿é…è‰²
            const observer = new MutationObserver(() => syncPanelTheme());
            observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
            syncPanelTheme();
        }

        function syncPanelTheme() {
            const panel = document.getElementById('panel');
            if (!panel) return;
            if (document.body.classList.contains('dark-mode')) panel.classList.add('dark');
            else panel.classList.remove('dark');
        }

        // ===== å·¦å³åˆ†é¡µé€»è¾‘ï¼ˆä¸»é¡µ/è§†å¥¸é¡µï¼‰ =====
        let currentSlide = 0; // 0: ä¸»é¡µ, 1: è§†å¥¸é¡µ
        function initPaging() {
            const slides = document.getElementById('slides');
            // è¿›å…¥é¡µé¢é»˜è®¤å±•ç¤ºä¸»é¡µï¼Œ10s è‡ªåŠ¨åˆ·æ–°åœ¨åˆ‡æ¢åˆ°è§†å¥¸é¡µæ—¶å¯åŠ¨
            bindSwipe(slides);
            bindPointerSwipe(slides);
            syncPanelTheme();
            updateSlide();
        }
        function goLeft() { currentSlide = Math.max(0, currentSlide - 1); onSlideChanged(); }
        function goRight() { currentSlide = Math.min(1, currentSlide + 1); onSlideChanged(); }
        function onSlideChanged() {
            updateSlide();
            if (currentSlide === 1) { refreshStatus(); }
        }
        function updateSlide() {
            const slides = document.getElementById('slides');
            slides.style.transform = `translate3d(-${currentSlide * 100}vw, 0, 0)`;
        }
        function bindSwipe(el) {
            let startX = 0, deltaX = 0, touching = false;
            el.addEventListener('touchstart', (e) => { touching = true; startX = e.touches[0].clientX; });
            el.addEventListener('touchmove', (e) => { if (!touching) return; deltaX = e.touches[0].clientX - startX; });
            el.addEventListener('touchend', () => {
                if (!touching) return; touching = false;
                if (deltaX < -50) goRight(); else if (deltaX > 50) goLeft();
                deltaX = 0;
            });
        }

        // é¼ æ ‡/è§¦æ§æ¿æ‹–æ‹½æ”¯æŒ
        function bindPointerSwipe(el) {
            let startX = 0, deltaX = 0, down = false;
            el.addEventListener('mousedown', (e) => { down = true; startX = e.clientX; });
            window.addEventListener('mousemove', (e) => { if (!down) return; deltaX = e.clientX - startX; });
            window.addEventListener('mouseup', () => {
                if (!down) return; down = false;
                if (deltaX < -50) goRight(); else if (deltaX > 50) goLeft();
                deltaX = 0;
            });
        }

        async function refreshStatus() {
            try {
                const res = await fetch(API_STATUS, { cache: 'no-store' });
                const data = await res.json();
                const { devices = [], status = 'offline', updateTime = '-' } = data || {};
                allDevices = Array.isArray(devices) ? devices : [];
                currentPage = 1;
                renderOverall(status, updateTime, allDevices.length);
                renderPage();
            } catch (e) {
                console.error('status fetch error', e);
            }
        }

        function renderOverall(status, updateTime, total) {
            document.getElementById('overall').textContent = status === 'online' ? 'åœ¨çº¿' : 'ç¦»çº¿';
            document.getElementById('uptime').textContent = 'æ›´æ–°æ—¶é—´ï¼š' + updateTime;
            document.getElementById('totalCount').textContent = total;
        }

        function renderPage() {
            const listEl = document.getElementById('deviceList');
            listEl.innerHTML = '';
            const total = allDevices.length;
            const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
            currentPage = Math.min(Math.max(1, currentPage), totalPages);

            const start = (currentPage - 1) * PAGE_SIZE;
            const pageItems = allDevices.slice(start, start + PAGE_SIZE);

            pageItems.forEach(d => {
                const li = document.createElement('li');
                li.className = 'item';
                const typeLabel = d.type === 'mobile' ? 'ğŸ“± Mobile' : (d.type === 'pc' ? 'ğŸ’» PC' : 'â“ Unknown');

                const nameDiv = document.createElement('div');
                nameDiv.className = 'nowrap';
                nameDiv.title = d.name || '';
                nameDiv.textContent = d.name || '';

                const typeDiv = document.createElement('div');
                const pill = document.createElement('span');
                pill.className = 'type-pill';
                pill.textContent = typeLabel;
                typeDiv.appendChild(pill);

                const titleDiv = document.createElement('div');
                titleDiv.className = 'nowrap';
                const titleSpan = document.createElement('span');
                titleSpan.className = 'title-link';
                const isMobile = window.innerWidth <= 768;
                const maxLen = isMobile ? 14 : 28;
                const fullTitle = d.windowTitle || '-';
                const displayTitle = fullTitle.length > maxLen ? (fullTitle.slice(0, maxLen) + 'â€¦') : fullTitle;
                titleSpan.textContent = displayTitle;
                titleSpan.title = fullTitle;
                titleSpan.addEventListener('click', () => openTitleModal(d.name || '', fullTitle));
                titleDiv.appendChild(titleSpan);

                li.appendChild(nameDiv);
                li.appendChild(typeDiv);
                li.appendChild(titleDiv);
                listEl.appendChild(li);
            });

            document.getElementById('pageInfo').textContent = `${currentPage}/${totalPages}`;
            document.getElementById('prevBtn').disabled = currentPage <= 1;
            document.getElementById('nextBtn').disabled = currentPage >= totalPages;
        }

        function gotoPrev() { currentPage -= 1; renderPage(); }
        function gotoNext() { currentPage += 1; renderPage(); }

        // ===== è‡ªå®šä¹‰æ ‡é¢˜å¼¹çª— =====
        function openTitleModal(deviceName, text) {
            const overlay = document.getElementById('titleModal');
            const body = document.getElementById('titleModalBody');
            const header = document.getElementById('titleModalHeaderText');
            header.textContent = `${deviceName}æ­£åœ¨å¹²ä»€ä¹ˆğŸ‘`;
            body.textContent = text || '';
            overlay.classList.add('active');
        }
        function closeTitleModal() {
            document.getElementById('titleModal').classList.remove('active');
        }
    </script>
</body>
</html>
